# Парсер данных PostgreSQL в Excel

Это Python-приложение для извлечения данных из базы данных PostgreSQL и экспорта их в Excel-файл.

## Требования

- Python 3.7+
- PostgreSQL

## Установка

1. Установите зависимости:

   ```bash
   pip install -r requirements.txt
   ```

2. Скопируйте `.env.example` в `.env` и настройте переменные окружения для подключения к БД:

   ```bash
   cp .env.example .env
   ```

   Отредактируйте `.env` файл с вашими настройками БД.

## Использование

Запустите приложение с указанием ID формы и опционально пути к выходному файлу:

```bash
python main.py --form-id 1 --output results.xlsx
```

### Аргументы командной строки

- `--form-id` или `-f`: ID формы для экспорта (обязательный)
- `--output` или `-o`: Путь к выходному Excel-файлу (по умолчанию: output.xlsx)

## Структура Excel-файла

Файл содержит один лист с колонками:

- **Столбец A (Telegram ID)**: ID пользователя в Telegram
- **Столбцы B и далее**: Каждый столбец соответствует полю формы согласно его позиции (position из form_fields)

В первой строке находятся заголовки:

- Ячейка A1: "Telegram ID"
- Остальные ячейки первой строки: метки полей формы (field_label)

Каждая последующая строка соответствует одному пользователю, где:

- Столбец A: Telegram ID пользователя
- Остальные столбцы: ответы пользователя на соответствующие поля формы

## Логика работы

1. Подключение к PostgreSQL с использованием конфигурации из переменных окружения.
2. Извлечение данных из таблиц `responses`, `response_fields`, `form_fields` и `forms`.
3. Для каждого ответа на форму записывается каждая пара поле-значение с Telegram ID пользователя.
4. Данные записываются в Excel-файл с автоматической настройкой ширины столбцов.

## Обработка ошибок

Приложение включает обработку ошибок:

- Ошибки подключения к БД
- Отсутствие данных
- Ошибки записи в файл

Все ошибки логируются в консоль.
